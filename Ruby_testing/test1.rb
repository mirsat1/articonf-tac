require 'json'

j = '{
  "_index": "smart_demand_clusters",
  "_type": "_doc",
  "_id": "tZaTa3UBcj8bPakkBjCQ",
  "_version": 1,
  "_score": 0,
  "_source": {
    "layer_name": "Demand_Layer",
    "@timestamp": "2020-10-27T19:38:28.899Z",
    "nodes": [
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "20",
        "Postcode": "2259",
        "UniqueID": "35b23e1f81f22ec283815e7df02d07be1d0b28891f02766799a34cf3e95980f7",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "33",
        "Postcode": "2303",
        "UniqueID": "8692ad16f5312f27ed987e7ba5eb4c1172ea4832b15229fd9f92d373238e4f55",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "35",
        "Postcode": "2284",
        "UniqueID": "b1245afee668421968ef30de995185724b61adbd79a120436fb8681a42740a2b",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "38",
        "Postcode": "2259",
        "UniqueID": "5e16678db6e117ec9465c675a8a1757e8d5e5d65f63f3a815bebb6a29ac90021",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "39",
        "Postcode": "2259",
        "UniqueID": "462a8579b1d93253add34c25360b233195fc1b727f4dd8e40c0e530919d03217",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "56",
        "Postcode": "2227",
        "UniqueID": "ee2b85f30afa3e1869821dfd8966a890bb86613f8c999d394772d3dac447d311",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "69",
        "Postcode": "2261",
        "UniqueID": "0df412f38fad21c11474c82c61fd0fafab8e2890dfbfdcef72f518bad17219d7",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "73",
        "Postcode": "2305",
        "UniqueID": "f0f91e20d46e7a8d44ebc42ee4c35cbaeedf8286cf002ff0a7e85af3c2abb804",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "74",
        "Postcode": "2082",
        "UniqueID": "6186fbd1e0c22a4a0d099026a37f3d27e289b929089e77e494c8bce9583285d3",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "75",
        "Postcode": "2251",
        "UniqueID": "f9d5d63c44ba5110c183948d59000c42a7e039253f47593f04b193612953092f",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "82",
        "Postcode": "2074",
        "UniqueID": "ea2d3de570d82b2b3e9b4e04cf83bf8091a7dbf5a6b42d082dbe3297c19d04d7",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "87",
        "Postcode": "2290",
        "UniqueID": "360d189cb77d9d2313b93234f99ad1f2fcc97051c29a1860d4dfa9f1e2e0ad84",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "88",
        "Postcode": "2290",
        "UniqueID": "09204c94c6df9f5387f2595ebaaac3f3041e6ec0bec525816941b86c1a183a42",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "101",
        "Postcode": "2262",
        "UniqueID": "87491fec330b7307fb7b97ab9a222ea741c734bd3423fc5287d406bfbb578f76",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "104",
        "Postcode": "2320",
        "UniqueID": "3f4e25902ecd8a154525706c97824144b985beebeb433e519f775d32a1702d59",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "106",
        "Postcode": "2259",
        "UniqueID": "4ae524cd14970a30200224aeb084236ca5cca62f9782db0af448f8810ede872c",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "109",
        "Postcode": "2093",
        "UniqueID": "8b4bd4726ebe9b662ef1b69d6173a2ca18f03b5525c134b3d9c35f1b5728a6ad",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "110",
        "Postcode": "2290",
        "UniqueID": "9cf09df5db21261de2e466420223846fa25e5485b53102aea4f889266cb08872",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "119",
        "Postcode": "2280",
        "UniqueID": "7daadda2f002c67a3c966d5005e1060b17ef2e00bc141154e0aa8f40b7753e27",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "124",
        "Postcode": "2289",
        "UniqueID": "1bceb4b8c8e682923fbaa53454a2b98768ac27a66dc9775e514edc5bd97b8c3f",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "130",
        "Postcode": "2262",
        "UniqueID": "bc749c64c6ff74b7f6813afda456fc57902586fdaaacef542c530f38e595c475",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "137",
        "Postcode": "2263",
        "UniqueID": "4386fe6e7471f6ac051e859ccfa52125d218fe2017f729ee05cec72bf1b67fac",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "141",
        "Postcode": "2126",
        "UniqueID": "5d1cbd88295d43716b5c60f7e9601c551fc04e7a4c97081eba1fd6911f83e5cb",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "144",
        "Postcode": "2300",
        "UniqueID": "b5e0ab48fa78730b93d61e6bfae72338abd2cf03995336a1471a9c92b0775ec1",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "152",
        "Postcode": "2325",
        "UniqueID": "d8dbe08cb48f0eac5ea584d2fc6c26a2e48b281319eb891b1eb4c2d43515e286",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "153",
        "Postcode": "2303",
        "UniqueID": "cf4234d7071687cbe07c745bb9e973ebd01d55f2121a0b247a426be35c9b3634",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "157",
        "Postcode": "2291",
        "UniqueID": "f990ba669b9d75c6835195fbdc8299633ed024b8862b26816ea15819d3ece37d",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "161",
        "Postcode": "2120",
        "UniqueID": "e93652f1f0ae4551e934b371101a31789a78a400adc8185ea66383ec3bcae494",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "169",
        "Postcode": "2259",
        "UniqueID": "0f39d4660d4a7d6252206c7973c36b6261886699d74d93216006d82a9ad183e6",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "176",
        "Postcode": "2293",
        "UniqueID": "0ddfaa387886bd1b2daff19ab1508dc29db4d580bfb21b5f04c2e8abefe14b30",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "184",
        "Postcode": "2259",
        "UniqueID": "8c16089f5e1594e185033d68468313164b32bafc8d17959a2ab8f1806fea38fa",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "188",
        "Postcode": "2289",
        "UniqueID": "b612498021d91e63e6ad51fbda21310aa45b919c94caac0ccae2d95c457bf3ad",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "189",
        "Postcode": "2263",
        "UniqueID": "37b0815c5a740d6cf304019a1e2bb0083a924a7c5e377eb644c979b7673aab03",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "193",
        "Postcode": "2205",
        "UniqueID": "b8ec2ab42d8525f77f96e7139da11cc58b3d8a77b40f611431f1c930a36a9d3f",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "201",
        "Postcode": "2291",
        "UniqueID": "62706abf92d027149976cfc40c4de1ef02ff506f7db54db452a59ef14f82ae4a",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "202",
        "Postcode": "2259",
        "UniqueID": "05aad3b4ce56aa8b33bbfdedb2fa0e6efa6c93f8b23fc34034d596ee68255025",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "204",
        "Postcode": "2077",
        "UniqueID": "d9d44b0ad0b6a7f46b544d7b7906fefbcaf3c8d4fc90564eff2e09a5bba07e14",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "206",
        "Postcode": "2259",
        "UniqueID": "cc3e104fde717145c7d7fb2a403e5ad77ddd8d7d9fcdde5fc775e44841404c59",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "207",
        "Postcode": "2290",
        "UniqueID": "e0e856df34c90dc98a8a8d50a9c89171ab3f3abe3347cfa16dc644f1f824bdf6",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "210",
        "Postcode": "2079",
        "UniqueID": "fb286672baaa207542adbe5dde032bffee3d0b20c675c4138a0626febef8e7bd",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "211",
        "Postcode": "2285",
        "UniqueID": "d36678bec62a4f88a8bedce3ce2233eb56b10baf308ee337fe6036e9faaf39d1",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "212",
        "Postcode": "2325",
        "UniqueID": "888b9ba132e582ba8250e6530ba450d4478ef9a35b7e7c94683a02fb68c81176",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "214",
        "Postcode": "2285",
        "UniqueID": "e36dbb23051f6fde2c7ef64418f59a1aa048d6165a19cae64faa0889c8ca3448",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "218",
        "Postcode": "2264",
        "UniqueID": "0f684710fb8258e730d1ec8e7a798e07efb85494c686234a0a7fbaf148ba68e0",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "244",
        "Postcode": "2204",
        "UniqueID": "7ab7eee5b4ced9957fd809984637784009fa636aa02910550c9dfafbfb713992",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "246",
        "Postcode": "2261",
        "UniqueID": "55e13c5ecbe7a26a7ab173e5dca109ba0198719bf447228213d029c4d900ee53",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "253",
        "Postcode": "2285",
        "UniqueID": "6b65db0bdc37ff82e3f0214ad52f6e8c61e967aec1412dd456e3ac7302514d6d",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "256",
        "Postcode": "2291",
        "UniqueID": "a3a744e60cd0e3973d6425ed167fb096324bab2ef6679b7a9991b18bc90b7a9c",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "273",
        "Postcode": "2320",
        "UniqueID": "ee16c82ec5457cbc383643f4967c8e0e87f1c55c1835682d38adc8246aaf126a",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "276",
        "Postcode": "2261",
        "UniqueID": "ec41de74ce5317cb68ac4702209f055ad48935d162bb7ab2cd5993fe6f4d0747",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      },
      {
        "layer_name": "Demand_Layer",
        "Timestamp": "2012-10-27 04:00:00",
        "Customer": "297",
        "Postcode": "2261",
        "UniqueID": "888fb63b91dce3d0420e8ec6918c3738e5de0291ba06ab86316494ee728877aa",
        "Total_Demand_MWh": "5813.23",
        "cluster_label": 15931,
        "use_case": "smart-energy",
        "use_case_table": "smart-energy"
      }
    ],
    "cluster_label": 15931,
    "label": "5813.23 -- 5813.23",
    "use_case": "smart-energy",
    "@version": "1",
    "use_case_table": "smart-energy"
  },
  "fields": {
    "@timestamp": [
      "2020-10-27T19:38:28.899Z"
    ]
  }
}'
hash = JSON.parse(j)
nodesarr = hash.dig "_source", "nodes"
# nodesarr.each{|item| item["Customer"].gsub!("\"", "") }
nodesarr.each{|item| item["Total_Demand_MWh"]=item["Total_Demand_MWh"].to_f }
nodesarr.each{|k| k["position"]={"lat"=>k["Customer"].to_i, "lon"=>k["Postcode"].to_i}}
# hash.each{ |key, value|
#   puts "Key = #{key} / Value = #{value}"
# }

a=nodesarr[0]["Total_Demand_MWh"]
b=nodesarr[1]["Total_Demand_MWh"]
sum=a+b
p sum
p nodesarr[0]
